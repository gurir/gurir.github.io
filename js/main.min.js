var t,at,ev,render_h=0,step=100,frames=parseInt(data[section].frames)||36,frame=1,start_x=0,dir_real=0,dist_last=0,dir_last="",dir2=0,dist2=0,swipe_start=!1,mouse_x=0,mouse_y=0,width=1920,height=1080,a_rotate=!0,current_hover_id=0,clickable=!0,clicked=!1,clicked_id=0,view_mode="3D",faved=!1,coords={},coords_2D={},paused=!0,map_visible=!1,rwidth=pano?1280:data[section].width,rheight=pano?720:data[section].height,r2dwidth=rwidth,r2dheight=rheight,mode="all",isIframe=window.self!==window.top;isIframe=!1;var iconOpened=!1,devo=!1,offset_x=0,hotspots_3d=!1,areas_enable=!0,is_sold="",qres="",cb_active=!1,fov=60,allow_hotspot2d=!1;if(data.hasOwnProperty(section)&&(0==data[section].areas&&(areas_enable=!1),data[section].hasOwnProperty("width_2d")&&(r2dwidth=data[section].width_2d,r2dheight=data[section].height_2d),data[section].hasOwnProperty("def_frame")&&(frame=parseInt(data[section].def_frame)),data[section].hasOwnProperty("info"))){var output="";$.each(data[section].info,function(e,t){if(t.indexOf(":")>-1){var a=t.split(":");output+='<div class="col-6">'+ts(a[0])+'</div><div class="col-6 text-right">'+ts(a[1])+"</div>"}else output+='<div class="col-12">'+ts(t)+"</div>"}),$("#sinfo").html(output+'<div class="clear"></div>')}0==Cookies.get("a_rotate")&&(a_rotate=!1),pano&&($("#gback").attr("href",gback),$("#gback").show()),pano||0!=data[section].coords_3D.length||(mode="2d");var total_areas=0,isMobile=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(isMobile=!0);var isiOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;isiOS&&!isIframe&&$(".btn_toggle_fullscreen").addClass("inactive"),pano||0!=data[section].areas?0==(total_areas=pano?0:Object.keys(data[section].coords_2D).length)&&(total_areas=pano?0:Object.keys(data[section].coords_3D).length):total_areas=0;var appf="";for(pano||"floor"!=data[section].step||(appf="&f="+section_r+"&rf="+section),i=1;i<total_areas+1;i++)sold.includes("area_"+i)&&(is_sold=" area_sold"),"full_url"==data[section].prefix?$("#map").append('<area class="area'+is_sold+'" data-id="'+i+'" id="area_'+i+'" data-href="'+data[section].links["area_"+i]+'" data-info="true" shape="poly" coords="" />'):$("#map").append('<area class="area'+is_sold+'" data-id="'+i+'" id="area_'+i+'" data-href="'+data[section].prefix+data[section].links["area_"+i]+'" data-info="true" shape="poly" coords="" />'),is_sold="";function hideAbout(){clearInterval(at),$("#about").fadeOut()}$(function(){$("#viewer").swipe({swipeStatus:viewer_cnt,tap:taped,doubleTap:dtaped}),step=$("#renders").width()/frames,$("#close").click(function(){$("#sidebar").animate({marginLeft:"-100%"},350),clicked&&($("#icons ul").fadeIn(),iconOpened=!1)}),$("#openObject").click(function(){var e=$(this).attr("href");e=e.substring(9),"full_url"==data[section].prefix?window.location.href=e:window.location.href=e+appf+"&p="+project+("sq"!=lang?"&lang="+lang:"")}),$("#openInfo").click(function(){openSidebar($(this).attr("data-id"),"#sec_obj_info")}),$(".btn_toggle_cb").click(function(e){e.preventDefault(),(cb_active=!cb_active)?(viewer.enableEffect(PANOLENS.Modes.STEREO),viewer.enableControl(PANOLENS.Controls.DEVICEORIENTATION),screenfull.enabled&&screenfull.request(),$("#menu").fadeOut("slow"),$("#gback").fadeOut("slow"),$("#close_cb").fadeIn("slow")):(viewer.enableEffect(PANOLENS.Modes.NORMAL),viewer.enableControl(PANOLENS.Controls.ORBIT),screenfull.enabled&&screenfull.exit(),$("#menu").fadeIn("slow"),$("#gback").fadeIn("slow"),$("#close_cb").fadeOut("slow"))}),$(".btn_toggle_v3d").click(function(){paused||(clicked=!1,clicked_id=0,view_mode="3D",allow_hotspot2d=!1,$("#renders").attr("src",base_url+"/assets/"+project+"/"+section+"_renders/"+frame+".jpg"),adjust(),$("#svg").hide(),$(".btn_v").removeClass("active"),$(this).addClass("active"),a_rotate&&$("#pointer").show())}),$(".btn_toggle_v2dv").click(function(){paused||(clicked=!1,clicked_id=0,view_mode="2D",allow_hotspot2d=!0,"masterplan"==data[section].step&&"at-linda"==project&&width<720&&height<720&&isMobile&&(qres="_low"),$("#renders").attr("src",base_url+"/assets/"+project+"/"+section+"_2d/img_ren"+qres+".jpg"),adjust(),$("#svg").hide(),$(".btn_v").removeClass("active"),$(this).addClass("active"),a_rotate&&$("#pointer").hide())}),$(".btn_toggle_v2dt").click(function(){paused||(clicked=!1,clicked_id=0,view_mode="2D",allow_hotspot2d=!0,$("#renders").attr("src",base_url+"/assets/"+project+"/"+section+"_2d/img_tec.jpg"),adjust(),$("#svg").hide(),$(".btn_v").removeClass("active"),$(this).addClass("active"),a_rotate&&$("#pointer").hide())}),$.get(base_url+"/assets/"+project+"/"+section+"_2d/img_tec.jpg").fail(function(){$(".btn_toggle_v2dt").addClass("inactive")}),$.get(base_url+"/assets/"+project+"/"+section+"_2d/img_ren.jpg").fail(function(){$(".btn_toggle_v2dv").addClass("inactive")}),0==total_areas&&$(".btn_toggle_sec").addClass("inactive"),$(".btn_toggle_fullscreen").click(function(){isiOS?isiOS&&isIframe&&window.parent.postMessage("fullscreen","*"):(screenfull.enabled&&screenfull.toggle(),screenfull.isFullscreen?$(this).removeClass("active"):$(this).addClass("active"))}),$(".btn_toggle_fav").click(function(){(faved=!faved)?$(this).html('<i class="fa fa-heart" aria-hidden="true"></i>'):$(this).html('<i class="fa fa-heart-o" aria-hidden="true"></i>')}),$(".btn_toggle_sec").click(function(){paused||(paused=!0,highlighted=0,t=setInterval(highlightAll,500/total_areas),highlightAll())}),$(".btn_toggle_map").click(function(){openSidebar(0,"#sec_map"),$("#gmap").show(),window.dispatchEvent(new Event("resize")),map.setCenter(uluru)}),$(".btn_toggle_list").click(function(){openSidebar(0,"#sec_obj_all")}),$(".area").mouseover(function(e){if(!isMobile){var t=$(this).attr("data-id");if(clickable&&!clicked&&!paused){"3D"==view_mode?$("#polygon").attr("points",coords[$(this).attr("data-id")+"-"+frame]):"2D"==view_mode&&$("#polygon").attr("points",coords_2D[$(this).attr("data-id")]);var a="<h4>"+ts(data[section].titles["area_"+t])+"</h4><table>";$.each(data[section].infos["area_"+t],function(e,t){var s=t.split(":");a+="<tr><td>"+ts(s[0])+":</td><td>"+ts(s[1])+"</td></tr>"}),a+="</table>",1!=t&&8!=t&&"masterplan"==data[section].step&&"at-linda"==project&&(a+="<p><br/><b>Së shpejti. Shih llamellën A dhe H.</b></p>"),$("#infobox").html(a),$("#infobox").show(),$(this).hasClass("area_sold")?$("#svg").addClass("svg_sold"):$("#svg").removeClass("svg_sold"),$("#svg").show()}}}).mouseout(function(){clicked||isMobile||$("#svg").hide(),$("#infobox").hide()}),$("#s_masterplan").attr("href","/?s=situacioni&p="+project),pano||"masterplan"!=data[section].step?pano||"building"!=data[section].step?pano||"floor"!=data[section].step?(pano||"apartment"!=data[section].step)&&(pano||"apartament"!=data[section].step)||($("#s_masterplan").addClass("s_prev"),$("#s_building").addClass("s_prev"),$("#s_floor").addClass("s_prev"),$("#s_apartment").addClass("s_current"),$("#s_building").attr("href","/?s="+bld+"&p="+project+("sq"!=lang?"&lang="+lang:"")),$("#s_floor").attr("href","/?s="+flo+"&p="+project+("sq"!=lang?"&lang="+lang:"")),$("#gback").attr("href","/?s="+flo+"&p="+project+("sq"!=lang?"&lang="+lang:"")),$("#gback").show()):($("#s_masterplan").addClass("s_prev"),$("#s_building").addClass("s_prev"),$("#s_floor").addClass("s_current"),$("#s_apartment").addClass("s_next"),$("#s_building").attr("href","/?s="+data[section].parent+"&p="+project+("sq"!=lang?"&lang="+lang:"")),$("#gback").attr("href","/?s="+data[section].parent+"&p="+project+("sq"!=lang?"&lang="+lang:"")),$("#gback").show()):($("#s_masterplan").addClass("s_prev"),$("#s_building").addClass("s_current"),$("#s_floor").addClass("s_next"),$("#s_apartment").addClass("s_next"),$("#gback").attr("href","/?s=situacioni&p="+project+("sq"!=lang?"&lang="+lang:"")),masterplan&&$("#gback").show()):($("#s_masterplan").addClass("s_current"),$("#s_building").addClass("s_next"),$("#s_floor").addClass("s_next"),$("#s_apartment").addClass("s_next"),"bp"==project&&($("#gback").attr("href","http://chelseapoint.net/"),$("#gback").show())),"2d"==mode?(tech_2d?$(".btn_toggle_v2dt").trigger("click"):$(".btn_toggle_v2dv").trigger("click"),$(".btn_toggle_v3d").addClass("inactive")):$(".btn_toggle_v3d").addClass("active"),$(document).contextmenu(function(e){debug||(e.preventDefault(),$("#about").css("top",e.pageY+10),$("#about").css("left",e.pageX-90),$("#about").fadeIn(),at=setInterval(hideAbout,1500))}),$(".btn_zoom_plus").click(function(){viewer.getCamera().fov>30&&(viewer.getCamera().fov-=5,viewer.getCamera().updateProjectionMatrix())}),$(".btn_zoom_minus").click(function(){viewer.getCamera().fov<90&&(viewer.getCamera().fov+=5,viewer.getCamera().updateProjectionMatrix())}),$(".btn_toggle_do").click(function(){(devo=!devo)?(viewer.enableControl(PANOLENS.Controls.DEVICEORIENTATION),$(this).addClass("active")):(viewer.enableControl(PANOLENS.Controls.ORBIT),$(this).removeClass("active"))}),pano&&!isMobile&&$(".btn_toggle_do").addClass("inactive"),pano&&hfovfix(),debug&&($("#debug").show(),pano&&$("#dot").show())});var map,highlighted=0;function highlightAll(){highlighted++,"3D"==view_mode?$("#polygon").attr("points",coords[highlighted+"-"+frame]):($("#polygon").attr("points",coords_2D[highlighted]),console.log(coords_2D[highlighted])),$("#svg").show(),highlighted==total_areas+1&&(clearInterval(t),$("#svg").hide(),paused=!1)}function viewer_cnt(e,t,a,s,i,o,r,n){"3D"!=view_mode||paused||("left"!=n&&"right"!=n||(hotspots_3d&&$(".hotspot").remove(),clickable=!1,swipe_start||(swipe_start=!0,$("#svg").hide(),$("#icons ul").fadeOut(),iconOpened=!1),(dir2=n)!=dir_last&&(start_x=isMobile?e.touches[0]?e.targetTouches[0].pageX:0:e.pageX),"right"==dir2?(dist2=s-start_x)>step&&(++frame==frames+1&&(frame=1),start_x=mouse_x):(dist2=start_x-s)>step&&(0==--frame&&(frame=frames),start_x=mouse_x),dist_last=s,dir_last=dir2,changeFrame(),a_rotate&&(Cookies.set("a_rotate",0,{expires:1}),a_rotate=!1,$("#pointer").fadeOut())),"end"==t&&(ticks=1,dir_real=0,dir_last=0,swipe_start=!1,clickable=!0,clicked=!1,clicked_id=0,frameChanged()))}function changeFrame(){document.getElementById("renders").src=base_url+"/assets/"+project+"/"+section+"_renders/"+frame+".jpg"}function taped(e){for(var t=[],a=e.target;a!=document.body;)t.push(a),a=a.parentNode;null!=t[0].getAttribute("data-id")&&clickable&&!paused?(clicked=!0,t[0].getAttribute("data-id")==clicked_id?"full_url"==data[section].prefix?window.location.href=data[section].links["area_"+t[0].getAttribute("data-id")]+appf+"&p="+project+("sq"!=lang?"&lang="+lang:""):window.location.href=data[section].prefix+data[section].links["area_"+t[0].getAttribute("data-id")]+appf+"&p="+project+("sq"!=lang?"&lang="+lang:""):(clicked_id=t[0].getAttribute("data-id"),$("#sidebar").animate({marginLeft:"-100%"},350),openIcons(t[0].getAttribute("data-id")),"3D"==view_mode?$("#polygon").attr("points",coords[t[0].getAttribute("data-id")+"-"+frame]):$("#polygon").attr("points",coords_2D[t[0].getAttribute("data-id")]),$("#svg").show())):(clicked=!1,clicked_id=0,$("#icons ul").fadeOut(),iconOpened=!1,$("#svg").hide())}function dtaped(e){for(var t=[],a=e.target;a!=document.body;)t.push(a),a=a.parentNode;null!=t[0].getAttribute("data-id")&&clickable&&!paused&&""!=data[section].links["area_"+t[0].getAttribute("data-id")]&&(window.location.href=data[section].prefix+data[section].links["area_"+t[0].getAttribute("data-id")]+appf+"&p="+project+("sq"!=lang?"&lang="+lang:""))}function frameChanged(){for(i=1;i<total_areas+1;i++)$("#area_"+i).attr("coords",coords[i+"-"+frame]);hotspots_3d&&renderHotspots(),debug&&console.log(frame)}if(frameChanged(),"all"!=mode||pano){if(!pano){paused=!1,$("#viewer").removeClass("blur"),$("#renders").attr("src",base_url+"/assets/"+project+"/"+section+"_2d/img_ren.jpg"),(tmpImg=new Image).src=base_url+"/assets/"+project+"/"+section+"_2d/img_ren.jpg",tmpImg.onload=function(){$("#startup").fadeOut(),adjust(),t=setInterval(highlightAll,500/total_areas)}}}else{var loaded=0,n=0,c=0;for(i=1;i<frames+1;i++){var tmpImg;n++,(tmpImg=new Image).src=base_url+"/assets/"+project+"/"+section+"_renders/"+i+".jpg",tmpImg.onload=function(){$("#renders").attr("src",base_url+"/assets/"+project+"/"+section+"_renders/"+c+".jpg"),c++}}var interval=setInterval(function(){percent=n/100,loaded=Math.ceil(c/percent),$("#progress span").text(loaded),$("#progressbar_tick").css("width",loaded+"%"),100==loaded&&(clearInterval(interval),adjust(),$("#viewer").removeClass("blur"),$("#renders").attr("src",base_url+"/assets/"+project+"/"+section+"_renders/"+frame+".jpg"),$("#startup").fadeOut(),a_rotate?($("#pointer").fadeIn(),$("#pointer").addClass("a_rotate")):$("#pointer").hide(),t=setInterval(highlightAll,500/total_areas))},1)}function adjust(){(clicked=!1,clicked_id=0,$("#icons ul").hide(),iconOpened=!1,pano)||($("#svg").hide(),$("#renders").css("width","auto"),$("#renders").height($(window).height()),$("#viewer").width($("#renders").width()),$("#viewer").css("left","50%"),$("#viewer").css("margin-left","-"+$("#viewer").width()/2+"px"),$("#viewer").css("margin-top","0"),width=$("#renders").width(),height=$("#renders").height(),width>$(window).width()&&($("#renders").width($(window).width()),$("#renders").css("height","auto"),width=$("#renders").width(),height=$("#renders").height(),$("#viewer").css("margin-top",($(window).height()-height)/2+"px"),$("#viewer").css("left","0"),$("#viewer").css("margin-left","0")),$("#viewer").width($("#renders").width()),$("#viewer").height($("#renders").height()),offset_x=(width-16*height/9)/2);if($("#viewer").height()<$("#menu").height()?($("#menu").addClass("menu_adapt"),isiOS&&$("#menu").addClass("menu_adapt_ios"),$("#menu").hasClass("menu_no3d")?$("#menu").removeClass("menu_no3d_mt"):$("#menu").addClass("menu_3d_mt"),$(".btn_toggle_map").hide()):($("#menu").removeClass("menu_adapt"),isiOS&&$("#menu").removeClass("menu_adapt_ios"),$("#menu").hasClass("menu_no3d")?$("#menu").addClass("menu_no3d_mt"):$("#menu").removeClass("menu_3d_mt"),$(".btn_toggle_map").show()),"3D"==view_mode){if("all"==mode&&areas_enable){for(i=1;i<total_areas+1;i++)for(f=1;f<37;f++){var e=data[section].coords_3D["area_"+i][f],t=!1,a="",s=0;$.each(e,function(e,i){s=t?parseInt(width*i/rwidth)-pw_offset:parseInt(height*i/rheight),a=a+","+s,t=!t}),coords[i+"-"+f]=a.substring(1)}frameChanged()}}else if("2D"==view_mode)for(i=1;i<total_areas+1;i++){e=data[section].coords_2D["area_"+i],t=!1,a="",s=0;$.each(e,function(e,i){s=t?parseInt(width*i/r2dwidth):parseInt(height*i/r2dheight),a=a+","+s,t=!t}),coords_2D[i]=a.substring(1),$("#area_"+i).attr("coords",coords_2D[i])}if(!pano&&void 0!==data[section].hotspots&&allow_hotspot2d)for(total_areas=Object.keys(data[section].hotspots).length,$(".hotspot").remove(),i=1;i<total_areas+1;i++){var o=parseInt(data[section].hotspots["area_"+i][0])*width/r2dwidth-30,r=parseInt(data[section].hotspots["area_"+i][1])*height/r2dheight-32;$("#viewer").append('<div data-href="'+data[section].links["area_"+i]+'" class="hotspot" style="top:'+r+"px;left:"+o+'px;"><img src="'+base_url+"/img/ripple"+ripple+'.svg"/><div></div></div>')}else $(".hotspot").remove();pano||void 0===data[section].hotspots_3D||(total_areas=Object.keys(data[section].hotspots_3D).length,hotspots_3d=!0,renderHotspots()),step=$("#renders").width()/frames}function renderHotspots(){$(".hotspot").remove();var e=0,t=0;$.each(data[section].hotspots_3D,function(a,s){t=s.y*height/720-32,$.each(s,function(i,o){i==frame&&(e=o*width/1280-32+offset_x,$("#viewer").append('<div data-id="'+a+'" class="hotspot hotspot_3d" data-href="'+s.url+'" style="left:'+e+"px;top:"+t+'px"><img src="'+base_url+'/img/ripple_2.svg"/><div></div></div>'))})})}function openSidebar(e,t){if($(".sec_side").hide(),$(t).show(),e>0){var a=data[section].prefix+data[section].links["area_"+e]+appf+"&p="+project;$("#view_object").attr("href",a),$("#sidebar h2").text(ts(data[section].titles["area_"+e]));var s="<table>";$.each(data[section].infos["area_"+e],function(e,t){var a=t.split(":");s+="<tr><td>"+ts(a[0])+":</td><td>"+ts(a[1])+"</td></tr>"}),s+="</table>",""==data[section].links["area_"+e]&&"at-linda"==project&&(s+="<p><br/><b>Së shpejti. Shih llamellën A dhe H.</b></p>"),$("#sidebar p").html(s)}$("#sidebar").animate({marginLeft:0},350),$("#icons ul").fadeOut(),iconOpened=!1}function openIcons(e){iconOpened&&$("#icons ul").fadeOut("fast");var t=data[section].prefix+data[section].links["area_"+e];""==data[section].links["area_"+e]?($("#openObject").addClass("btn_inactive"),$("#view_object").addClass("btn_inactive")):($("#openObject").removeClass("btn_inactive"),$("#view_object").removeClass("btn_inactive")),$("#openObject").attr("href",t),$("#openInfo").attr("data-id",e),$("#icons ul").fadeIn(),iconOpened=!0}function hfovfix(){p_height=window.innerHeight,p_width=window.innerWidth;p_width,p_height}function initMap(){map=new google.maps.Map(document.getElementById("gmap"),{zoom:16,center:uluru});new google.maps.Marker({position:uluru,map:map})}function hasTouch(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}if($(window).resize(function(){adjust(),pano&&hfovfix()}),$(document).bind("touchmove",function(e){isMobile&&(mouse_x=parseInt(e.targetTouches[0].pageX),mouse_y=parseInt(e.targetTouches[0].pageY))}),$(document).bind("mousemove",function(e){e.preventDefault(),isMobile||(mouse_x=parseInt(e.pageX),mouse_y=parseInt(e.pageY),$("#infobox").css("top",mouse_y+40),$("#infobox").css("left",mouse_x-150))}),$(document).on("click",".s_next",function(e){e.preventDefault()}),$(document).on("click",".s_current",function(e){e.preventDefault(),window.location.reload(!0)}),$(document).on("click",".hotspot",function(e){e.preventDefault(),$(this).hasClass("hotspot_3d")?"proview"==project?window.location.href="http://demos2.proview360.ch/p/demo/"+$(this).attr("data-href"):"immobrille"==project?window.location.href="http://demo2.immobrille.ch/p/demo/"+$(this).attr("data-href"):"demo-car"==project?window.location.href=$(this).attr("data-href"):window.location.href="http://int.buildinform.com/p/bernica-park/"+$(this).attr("data-href"):window.location.href=gback+"&v="+$(this).attr("data-href")}),$(document).on("click",".bi-hotspot",function(e){e.preventDefault(),"none"!=$(this).attr("data-href")&&(window.location.href=gback+"&v="+$(this).attr("data-href")+"&refh="+refh)}),hasTouch())try{for(var si in document.styleSheets){var styleSheet=document.styleSheets[si];if(styleSheet.rules)for(var ri=styleSheet.rules.length-1;ri>=0;ri--)styleSheet.rules[ri].selectorText&&styleSheet.rules[ri].selectorText.match(":hover")&&styleSheet.deleteRule(ri)}}catch(e){}function enableNoSleep(){noSleep.enable(),document.removeEventListener("click",enableNoSleep,!1)}function ts(e){if(-1!=e.indexOf("@[")){let t=e.indexOf("@["),a=e.indexOf("]",t),s=e.substring(t+2,a);e=e.replace("@["+s+"]",l10n[s][lang])}return e}
